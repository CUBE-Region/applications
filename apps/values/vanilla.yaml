# yaml-language-server: $schema=https://artifacthub.io/api/v1/packages/41047d86-5c50-4d89-b4fc-9083efcd7acf/4.26.3/values-schema

initContainers: []
sidecarContainers: []

resources:
  requests:
    memory: 5Gi
  limits:
    memory: 5Gi

workloadAsStatefulSet: true
strategyType: RollingUpdate

affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
        - matchExpressions:
            - key: kubernetes.io/hostname
              operator: In
              values:
                - k8s-w-edelweiss

minecraftServer:
  eula: TRUE
  version: 1.21.4
  type: PAPER
  difficulty: peaceful
  announcePlayerAchievements: false
  generateStructures: false
  spawnAnimals: false
  spawnMonsters: false
  spawnNPCs: false
  spawnProtection: 0
  gameMode: creative
  motd: "Welcome to Minecraft on Kubernetes!"
  onlineMode: true
  enforceSecureProfile: true
  memory: 4G
  serviceType: LoadBalancer
  loadBalancerClass: tailscale
  pluginUrls:
    - https://ci.athion.net/job/goBrush-1.13+/87/artifact/build/libs/goBrush-3.8.0-87.jar # TODO: setting
  modrinth:
    projects:
      - "datapack:terralith"
      - "datapack:terratonic"
      - "datapack:william-wythers-overhauled-overworld-(datapack)"
      - "fastasyncworldedit:cf5QSDJ7" # TODO: setting
      - "gopaintadvanced" # TODO: setting
      - "essentialsx" # TODO: setting
      - "luckperms" # TODO: setting
      - "worldguard" # TODO: setting
  spigetResources:
    - 17311 # WorldEditSelectionVisualizer TODO: setting

  rcon:
    enabled: ture
    existingSecret: minecraft-cube-vanilla-secret
    secretKey: rcon-password
    serviceType: LoadBalancer
    loadBalancerClass: tailscale

extraEnv:
  DATAPACKS: "https://github.com/CUBE-Region/cube-vanilla-datapack/releases/download/0.1.0/cube-vanilla-datapack.zip"
  ENABLE_WHITELIST: "true"
  WHITELIST:
    valueFrom:
      secretKeyRef:
        name: minecraft-cube-common-secret
        key: whitelist

serviceAnnotations:
  tailscale.com/hostname: minecraft-cube-vanilla
rconServiceAnnotations:
  tailscale.com/hostname: minecraft-cube-vanilla-rcon

mcbackup:
  enabled: true
  pauseIfNoPlayers: "false"
  backupInterval: 3h
  excludes: "*.jar,cache,logs"

  backupMethod: restic
  pruneResticRetention: "--keep-tag manual --keep-within-daily 7d --keep-within-weekly 1m --keep-within-monthly 1y --keep-within-yearly 99y"
  resticEnvs:
    RESTIC_REPOSITORY:
      valueFrom:
        secretKeyRef:
          name: minecraft-cube-vanilla-secret
          key: s3-backup-repository
    RESTIC_PASSWORD:
      valueFrom:
        secretKeyRef:
          name: minecraft-cube-vanilla-secret
          key: s3-backup-password
    AWS_ACCESS_KEY_ID:
      valueFrom:
        secretKeyRef:
          name: minecraft-cube-common-secret
          key: s3-access-key-id
    AWS_SECRET_ACCESS_KEY:
      valueFrom:
        secretKeyRef:
          name: minecraft-cube-common-secret
          key: s3-secret-access-key
    RESTIC_CACERT: /etc/ssl/certs/restic-ca/homelab-ca.crt

extraVolumes:
  - volumes:
      - name: homelab-ca-certs
        secret:
          secretName: operator-ca-tls-minio
          items:
            - key: ca.crt
              path: homelab-ca.crt
    volumeMounts:
      - name: homelab-ca-certs
        mountPath: /etc/ssl/certs/restic-ca

persistence:
  dataDir:
    enabled: true
    existingClaim: minecraft-cube-vanilla-pvc
